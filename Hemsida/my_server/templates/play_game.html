<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8"> 
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Play game</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.5.4/socket.io.js" integrity="sha512-YeeA/Qxn5hYdkukScTCNNOhTrv1C2RubAGButJ1rmgQwZf/HdRaCGl+JAVkqsqaNRaYNHdheiuKKuPf9mDcqKg==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <link rel="stylesheet" href="{{url_for('static', filename='style.css')}}">
    <script src="https://code.jquery.com/jquery-3.6.1.min.js" integrity="sha256-o88AwQnZB+VDvE9tvIXrMQaPlFFSUTR+nldQm1LuPXQ=" crossorigin="anonymous"></script>
    <script src="{{url_for('static', filename='script.js')}}"></script>
</head>
<body>
    <script>
        $(document).onload(()=> {
            let room_id = $("#gameid").val
            let game = $("#gameObject").val


            const updatePage = () => {
                //do socket requests that request info
                //update the page based on the received info

                socket.emit('update_canvas', {
                    room_id : room_id
                })
            }

            socket.on('update', (data)=> {
                //update canvas based on the data receivec back from the server
            })

            $( "#myCanvas").on( "keypress", function() {
                console.log( "Handler for `keypress` called." );
                //find out which key was pressed
                socket.emit('key_pressed', {
                    player_id : my_player_id,
                    //info about the key pressed (for example: move: 'right')
                })
              } );

            setInterval(updatePage, 500)

        })

    </script>
    <input type="hidden" value="{{game.room_id}}" id="gameid">
    <input type="hidden" value="{{game}}" id="gameObject">
    
    <h1>Player 1: {{game.players[0].name}}</h1>
    {% if game.awaiting_players == False %}
        <h1>Player 2: {{game.players[1].name}}</h1>
    {% endif %}
    {% if game.start_game() == True %}
        <canvas id="myCanvas" width="800" height="400"></canvas>
    {% else %}
        <h3>Waiting for player to join...</h3>
    {% endif %}

    <button onclick="leaveGame('{{game.room_id}}')">LÃ¤mna spel</button>
</body>
</html>